   1:				;
   2:				; midorg.z - MIDI Organ for TRS-80 
   3:				;
   4:     -	5200          		org	$5200
   5:				
   6:     -	402D          	@EXIT		equ	$402d
   7:     -	0049          	@KEY    	equ 	$0049 
   8:				
   9:     -	5200  2A2A2A2A	title:	ascii   "**** MIDI/80 ORGAN V1.0 - (C) 2024 G.PHILLIPS & LAMBDAMIKEL ****"
	              204D4944
	              492F3830
	              204F5247
	              414E2056
	              312E3020
	              2D202843
	              29203230
	              32342047
	              2E504849
	              4C4C4950
	              53202620
	              4C414D42
	              44414D49
	              4B454C20
	              2A2A2A2A
  10:     -	5240  2D2D2D2D		ascii   "----------------------------------------------------------------"
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
  11:     -	5280  2020205F		ascii   "   _____ _____       _____ _____ _____       _____ _____        "
	              5F5F5F5F
	              205F5F5F
	              5F5F2020
	              20202020
	              205F5F5F
	              5F5F205F
	              5F5F5F5F
	              205F5F5F
	              5F5F2020
	              20202020
	              205F5F5F
	              5F5F205F
	              5F5F5F5F
	              20202020
	              20202020
  12:     -	52C0  2020207C		ascii   "   |*c'# |*d'#|    |*f'# |*g'# |*a'# |     |*c''#|*d''#|        "
	              2A632723
	              207C2A64
	              27237C20
	              2020207C
	              2A662723
	              207C2A67
	              2723207C
	              2A612723
	              207C2020
	              2020207C
	              2A632727
	              237C2A64
	              2727237C
	              20202020
	              20202020
  13:     -	5300  20205F7C		ascii   "  _|__2__|__3_|____|__5__|__6__|__7__|_____|__9__|__0__|_ ____  "
	              5F5F325F
	              5F7C5F5F
	              335F7C5F
	              5F5F5F7C
	              5F5F355F
	              5F7C5F5F
	              365F5F7C
	              5F5F375F
	              5F7C5F5F
	              5F5F5F7C
	              5F5F395F
	              5F7C5F5F
	              305F5F7C
	              5F205F5F
	              5F5F2020
  14:     -	5340  207C2A63		ascii   " |*c'|* d' |*e' |*f' |* g' |* a' |* b' |*c'' |*d'' |*e'' |*f''| "
	              277C2A20
	              6427207C
	              2A652720
	              7C2A6627
	              207C2A20
	              6727207C
	              2A206127
	              207C2A20
	              6227207C
	              2A632727
	              207C2A64
	              2727207C
	              2A652727
	              207C2A66
	              27277C20
  15:     -	5380  207C5F51		ascii   " |_Q_|__W__|_E__|_R__|__T__|__Y__|__U__|__I__|__O__|__P__|__@_| "
	              5F7C5F5F
	              575F5F7C
	              5F455F5F
	              7C5F525F
	              5F7C5F5F
	              545F5F7C
	              5F5F595F
	              5F7C5F5F
	              555F5F7C
	              5F5F495F
	              5F7C5F5F
	              4F5F5F7C
	              5F5F505F
	              5F7C5F5F
	              405F7C20
  16:     -	53C0  20202020		ascii   "     _____ _____       _____ _____ _____       _____ _____      "
	              205F5F5F
	              5F5F205F
	              5F5F5F5F
	              20202020
	              2020205F
	              5F5F5F5F
	              205F5F5F
	              5F5F205F
	              5F5F5F5F
	              20202020
	              2020205F
	              5F5F5F5F
	              205F5F5F
	              5F5F2020
	              20202020
  17:     -	5400  20202020		ascii	"    |* c# |* d# |     |* f# |* g# |* a# |     |*c'# |*d'# |     "
	              7C2A2063
	              23207C2A
	              20642320
	              7C202020
	              20207C2A
	              20662320
	              7C2A2067
	              23207C2A
	              20612320
	              7C202020
	              20207C2A
	              63272320
	              7C2A6427
	              23207C20
	              20202020
  18:     -	5440  2020205F		ascii   "   _|__S__|__D__|_____|__G__|__H__|__J__|_____|__L__|__;__|_    "
	              7C5F5F53
	              5F5F7C5F
	              5F445F5F
	              7C5F5F5F
	              5F5F7C5F
	              5F475F5F
	              7C5F5F48
	              5F5F7C5F
	              5F4A5F5F
	              7C5F5F5F
	              5F5F7C5F
	              5F4C5F5F
	              7C5F5F3B
	              5F5F7C5F
	              20202020
  19:     -	5480  20207C2A		ascii   "  |*c |* d  |* e  |* f  |* g  |* a  |* b  |*c'  |*d'  |*e'  |   " 
	              63207C2A
	              20642020
	              7C2A2065
	              20207C2A
	              20662020
	              7C2A2067
	              20207C2A
	              20612020
	              7C2A2062
	              20207C2A
	              63272020
	              7C2A6427
	              20207C2A
	              65272020
	              7C202020
  20:     -	54C0  20207C5F		ascii	"  |_Z_|__X__|__C__|__V__|__B__|__N__|__M__|__,__|__.__|__/__|   "
	              5A5F7C5F
	              5F585F5F
	              7C5F5F43
	              5F5F7C5F
	              5F565F5F
	              7C5F5F42
	              5F5F7C5F
	              5F4E5F5F
	              7C5F5F4D
	              5F5F7C5F
	              5F2C5F5F
	              7C5F5F2E
	              5F5F7C5F
	              5F2F5F5F
	              7C202020
  21:     -	5500  20202020		ascii   "                                                                "
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
	              20202020
  22:     -	5540  42524541		ascii   "BREAK:QUIT L/R:INSTR UP/DOWN:VOL SPACE/ENT:CHANNEL AF/14:OCT +/-" 
	              4B3A5155
	              4954204C
	              2F523A49
	              4E535452
	              2055502F
	              444F574E
	              3A564F4C
	              20535041
	              43452F45
	              4E543A43
	              48414E4E
	              454C2041
	              462F3134
	              3A4F4354
	              202B2F2D
  23:     -	5580  43555220		ascii   "CUR <OCT/MIDI CHANNEL/INSTR/VOL>: <XX/XX/XX/XX> -  XX/XX/XX/XX  "
	              3C4F4354
	              2F4D4944
	              49204348
	              414E4E45
	              4C2F494E
	              5354522F
	              564F4C3E
	              3A203C58
	              582F5858
	              2F58582F
	              58583E20
	              2D202058
	              582F5858
	              2F58582F
	              58582020
  24:     -	55C0  2D2D2D2D		ascii   "----------------------------------------------------------------"
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
	              2D2D2D2D
  25:				
  26:     -	0400          	title_len equ $-title
  27:				
  28:				
  29:     -	5600  00      	current	byte 0
  30:     -	5601  00      	chan1	byte 0
  31:     -	5602  01      	chan2	byte 1
  32:     -	5603  30      	oct1	byte 48
  33:     -	5604  3C      	oct2	byte 60
  34:     -	5605  00010203	instr1	byte 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15
	              04050607
	              08090A0B
	              0C0D0E0F
  35:     -	5615  00010203	instr2	byte 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15
	              04050607
	              08090A0B
	              0C0D0E0F
  36:     -	5625  7F7F7F7F	vol1	byte 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127
	              7F7F7F7F
	              7F7F7F7F
	              7F7F7F7F
  37:     -	5635  7F7F7F7F	vol2	byte 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127
	              7F7F7F7F
	              7F7F7F7F
	              7F7F7F7F
  38:				
  39:     -	5645          	start:
  40:				
  41:    0+11	5645  DBFF    		in  a,($ff)
  42:   11+7	5647  F610    		or  a,$10 		; enable IO on Model III 
  43:					; and a,~$20 		; disable video wait states M III 
  44:   18+7	5649  E6BF    		and a,~$40 		; slode mode M4 
  45:   25+11	564B  D3EC    		out ($ec),a
  46:				
  47:   36+10	564D  210052  		ld	hl,title
  48:   46+10	5650  11003C  		ld	de,$3c00
  49:   56+10	5653  010004  		ld	bc,title_len
  50:   66+16+5	5656  EDB0    		ldir
  51:					
  52:					
  53:				defstep	macro	n,stp
  54:				step_&n	equ	stp
  55:					endm
  56:				
  57:				; Get the MIDI note numbers for 32 notes as step_0 .. step_31 
  58:				
  59:     -	0000          		nt = 0
  60:     -	0000          		note = 0 		; we'll add octave offsets... 
  61:     -	        		rept	32
  69:				
  70:				; Define these sensibly
  71:				
  72:     -	0000          	st_c0	equ	step_0
  73:     -	0001          	st_c0@	equ	step_1
  74:     -	0002          	st_d0	equ	step_2
  75:     -	0003          	st_d0@	equ	step_3
  76:     -	0004          	st_e0	equ	step_4
  77:     -	0005          	st_f0	equ	step_5
  78:     -	0006          	st_f0@	equ	step_6
  79:     -	0007          	st_g0	equ	step_7
  80:     -	0008          	st_g0@	equ	step_8
  81:     -	0009          	st_a0	equ	step_9
  82:     -	000A          	st_a0@	equ	step_10
  83:     -	000B          	st_b0	equ	step_11
  84:				
  85:     -	000C          	st_c1	equ	step_12
  86:     -	000D          	st_c1@	equ	step_13
  87:     -	000E          	st_d1	equ	step_14
  88:     -	000F          	st_d1@	equ	step_15
  89:     -	0010          	st_e1	equ	step_16
  90:     -	0011          	st_f1	equ	step_17
  91:     -	0012          	st_f1@	equ	step_18
  92:     -	0013          	st_g1	equ	step_19
  93:     -	0014          	st_g1@	equ	step_20
  94:     -	0015          	st_a1	equ	step_21
  95:     -	0016          	st_a1@	equ	step_22
  96:     -	0017          	st_b1	equ	step_23
  97:				
  98:     -	0018          	st_c2	equ	step_24
  99:     -	0019          	st_c2@	equ	step_25
 100:     -	001A          	st_d2	equ	step_26
 101:     -	001B          	st_d2@	equ	step_27
 102:     -	001C          	st_e2	equ	step_28
 103:     -	001D          	st_f2	equ	step_29
 104:				
 105:				
 106:				key	macro	addrmask,st,down
 107:					ld	b,st ;; changed to b by MW
 108:					ld	a,(addrmask >> 8)
 109:					and	addrmask % $100
 110:					call	nz,down
 111:					endm
 112:				
 113:				key_l	macro	addrmask,st
 114:					key	addrmask,st,key_down_lower
 115:					endm
 116:				
 117:				key_r	macro	addrmask,st
 118:					key	addrmask,st,key_down_upper
 119:					endm
 120:				
 121:				; Model 1 keyboard matrix.
 122:				;        1   2   4   8  16  32  64  128
 123:				; $3801	 @   A   B   C   D   E   F   G
 124:				; $3802	 H   I   J   K   L   M   N   O
 125:				; $3804	 P   Q   R   S   T   U   V   W
 126:				; $3808	 X   Y   Z
 127:				; $3810	 0   1   2   3   4   5   6   7
 128:				; $3820	 8   9   :   ;   ,   -   .   /
 129:				; $3840	ENT CLR BRK UP   DN  LT  RT SPC
 130:				; $3880	SFT
 131:				
 132:     -	0101          	k_@	equ	$380101
 133:     -	0102          	k_A	equ	$380102
 134:     -	0104          	k_B	equ	$380104
 135:     -	0108          	k_C	equ	$380108
 136:     -	0110          	k_D	equ	$380110
 137:     -	0120          	k_E	equ	$380120
 138:     -	0140          	k_F	equ	$380140
 139:     -	0180          	k_G	equ	$380180
 140:				
 141:     -	0201          	k_H	equ	$380201
 142:     -	0202          	k_I	equ	$380202
 143:     -	0204          	k_J	equ	$380204
 144:     -	0208          	k_K	equ	$380208
 145:     -	0210          	k_L	equ	$380210
 146:     -	0220          	k_M	equ	$380220
 147:     -	0240          	k_N	equ	$380240
 148:     -	0280          	k_O	equ	$380280
 149:				
 150:     -	0401          	k_P	equ	$380401
 151:     -	0402          	k_Q	equ	$380402
 152:     -	0404          	k_R	equ	$380404
 153:     -	0408          	k_S	equ	$380408
 154:     -	0410          	k_T	equ	$380410
 155:     -	0420          	k_U	equ	$380420
 156:     -	0440          	k_V	equ	$380440
 157:     -	0480          	k_W	equ	$380480
 158:				
 159:     -	0801          	k_X	equ	$380801
 160:     -	0802          	k_Y	equ	$380802
 161:     -	0804          	k_Z	equ	$380804
 162:				
 163:     -	1001          	k_0	equ	$381001
 164:     -	1002          	k_1	equ	$381002
 165:     -	1004          	k_2	equ	$381004
 166:     -	1008          	k_3	equ	$381008
 167:     -	1010          	k_4	equ	$381010
 168:     -	1020          	k_5	equ	$381020
 169:     -	1040          	k_6	equ	$381040
 170:     -	1080          	k_7	equ	$381080
 171:				
 172:     -	2001          	k_8	equ	$382001
 173:     -	2002          	k_9	equ	$382002
 174:     -	2004          	k_colon	equ	$382004
 175:     -	2008          	k_semi	equ	$382008
 176:     -	2010          	k_comma	equ	$382010
 177:     -	2020          	k_dash	equ	$382020
 178:     -	2040          	k_dot	equ	$382040
 179:     -	2080          	k_slash	equ	$382080
 180:				
 181:     -	4001          	k_enter	equ	$384001
 182:     -	4002          	k_clear	equ	$384002
 183:     -	4004          	k_break	equ	$384004
 184:     -	4008          	k_up	equ	$384008
 185:     -	4010          	k_down	equ	$384010
 186:     -	4020          	k_left	equ	$384020
 187:     -	4040          	k_right	equ	$384040
 188:     -	4080          	k_space	equ	$384080
 189:				
 190:     -	8001          	k_shift	equ	$388001
 191:				
 192:     -	5658          	init:
 193:				
 194:   82+17	5658  CD0B5C  		call screenupdate
 195:   99+17	565B  CD9A5C  		call setinstrument_lower
 196:  116+17	565E  CDBA5C  		call setinstrument_upper
 197:					
 198:     -	5661          	main:	
 199:  133+37	5661  06003A08		key_l	k_Z,st_c0
	              38E604C4
	              3A58
 200:  170+37	566B  06013A04		key_l	k_S,st_c0@
	              38E608C4
	              3A58
 201:  207+37	5675  06023A08		key_l	k_X,st_d0
	              38E601C4
	              3A58
 202:  244+37	567F  06033A01		key_l	k_D,st_d0@
	              38E610C4
	              3A58
 203:  281+37	5689  06043A01		key_l	k_C,st_e0
	              38E608C4
	              3A58
 204:  318+37	5693  06053A04		key_l	k_V,st_f0
	              38E640C4
	              3A58
 205:  355+37	569D  06063A01		key_l	k_G,st_f0@
	              38E680C4
	              3A58
 206:  392+37	56A7  06073A01		key_l	k_B,st_g0
	              38E604C4
	              3A58
 207:  429+37	56B1  06083A02		key_l	k_H,st_g0@
	              38E601C4
	              3A58
 208:  466+37	56BB  06093A02		key_l	k_N,st_a0
	              38E640C4
	              3A58
 209:  503+37	56C5  060A3A02		key_l	k_J,st_a0@
	              38E604C4
	              3A58
 210:  540+37	56CF  060B3A02		key_l	k_M,st_b0
	              38E620C4
	              3A58
 211:  577+37	56D9  060C3A20		key_l	k_comma,st_c1
	              38E610C4
	              3A58
 212:  614+37	56E3  060D3A02		key_l	k_L,st_c1@
	              38E610C4
	              3A58
 213:  651+37	56ED  060E3A20		key_l	k_dot,st_d1
	              38E640C4
	              3A58
 214:  688+37	56F7  060F3A20		key_l	k_semi,st_d1@
	              38E608C4
	              3A58
 215:  725+37	5701  06103A20		key_l	k_slash,st_e1
	              38E680C4
	              3A58
 216:				
 217:  762+37	570B  060C3A04		key_r	k_Q,st_c1
	              38E602C4
	              6058
 218:  799+37	5715  060D3A10		key_r	k_2,st_c1@
	              38E604C4
	              6058
 219:  836+37	571F  060E3A04		key_r	k_W,st_d1
	              38E680C4
	              6058
 220:  873+37	5729  060F3A10		key_r	k_3,st_d1@
	              38E608C4
	              6058
 221:  910+37	5733  06103A01		key_r	k_E,st_e1
	              38E620C4
	              6058
 222:  947+37	573D  06113A04		key_r	k_R,st_f1
	              38E604C4
	              6058
 223:  984+37	5747  06123A10		key_r	k_5,st_f1@
	              38E620C4
	              6058
 224: 1021+37	5751  06133A04		key_r	k_T,st_g1
	              38E610C4
	              6058
 225: 1058+37	575B  06143A10		key_r	k_6,st_g1@
	              38E640C4
	              6058
 226: 1095+37	5765  06153A08		key_r	k_Y,st_a1
	              38E602C4
	              6058
 227: 1132+37	576F  06163A10		key_r	k_7,st_a1@
	              38E680C4
	              6058
 228: 1169+37	5779  06173A04		key_r	k_U,st_b1
	              38E620C4
	              6058
 229: 1206+37	5783  06183A02		key_r	k_I,st_c2
	              38E602C4
	              6058
 230: 1243+37	578D  06193A20		key_r	k_9,st_c2@
	              38E602C4
	              6058
 231: 1280+37	5797  061A3A02		key_r	k_O,st_d2
	              38E680C4
	              6058
 232: 1317+37	57A1  061B3A10		key_r	k_0,st_d2@
	              38E601C4
	              6058
 233: 1354+37	57AB  061C3A04		key_r	k_P,st_e2
	              38E601C4
	              6058
 234: 1391+37	57B5  061D3A01		key_r	k_@,st_f2
	              38E601C4
	              6058
 235:				
 236: 1428+37	57BF  06003A40		key	k_space,0,swap_channel_down
	              38E680C4
	              FB59
 237:					
 238: 1465+37	57C9  06003A40		key	k_enter,0,incr_channel_down
	              38E601C4
	              275A
 239: 1502+37	57D3  06003A80		key	k_shift,0,decr_channel_down
	              38E601C4
	              6A5A
 240:				
 241: 1539+37	57DD  06003A40		key	k_break,0,exit
	              38E604C4
	              2A59
 242:					
 243: 1576+37	57E7  06003A40		key	k_left,0,decr_instr_down
	              38E620C4
	              FD5A
 244: 1613+37	57F1  06003A40		key	k_right,0,incr_instr_down
	              38E640C4
	              AD5A
 245:				
 246: 1650+37	57FB  06003A40		key	k_up,0,incr_vol_down
	              38E608C4
	              4D5B
 247: 1687+37	5805  06003A40		key	k_down,0,decr_vol_down
	              38E610C4
	              975B
 248:				
 249: 1724+37	580F  06003A01		key	k_A,0,oct1_down_down
	              38E602C4
	              9559
 250: 1761+37	5819  06003A01		key	k_F,0,oct1_up_down
	              38E640C4
	              2F59
 251:				
 252: 1798+37	5823  06003A10		key	k_1,0,oct2_down_down
	              38E602C4
	              C859
 253: 1835+37	582D  06003A10		key	k_4,0,oct2_up_down
	              38E610C4
	              6259
 254:				
 255: 1872+10	5837  C36156  		jp	main
 256:				
 257:				; In the simple case a key goes down, it self modifies so that when it goes
 258:				; up it turns off 
 259:				
 260:     -	00C4          	call_nz	equ	$C4
 261:     -	00CC          	call_z	equ	$CC
 262:				
 263:     -	583A          	key_down_lower:
 264: 1882+14	583A  FDE1    		pop	iy		; to self-modify key-down check, gets address where call nz,key_down happened 
 265: 1896+19	583C  FD36FDCC		ld	(iy-3),call_z	; trigger that op code there to a call_z, so when the key goes off, it calls key_up
 266: 1915+19	5840  FD36FE4D		ld	(iy-2),low(key_up_lower)
 267: 1934+19	5844  FD36FF58		ld	(iy-1),high(key_up_lower)
 268:				
 269: 1953+17	5848  CD8658  		call note_on_lower
 270:				
 271: 1970+8	584B  FDE9    		jp	(iy)		; return to main key scan loop
 272:				
 273:     -	584D          	key_up_lower:
 274: 1978+14	584D  FDE1    		pop	iy		; same idea, but swap call nz <-> call z
 275: 1992+19	584F  FD36FDC4		ld	(iy-3),call_nz
 276: 2011+19	5853  FD36FE3A		ld	(iy-2),low(key_down_lower)
 277: 2030+19	5857  FD36FF58		ld	(iy-1),high(key_down_lower)
 278:				
 279: 2049+17	585B  CDD858  		call note_off_lower 
 280:				
 281: 2066+8	585E  FDE9    		jp	(iy)		
 282:				
 283:				
 284:     -	5860          	key_down_upper:
 285: 2074+14	5860  FDE1    		pop	iy		; to self-modify key-down check, gets address where call nz,key_down happened 
 286: 2088+19	5862  FD36FDCC		ld	(iy-3),call_z
 287: 2107+19	5866  FD36FE73		ld	(iy-2),low(key_up_upper)
 288: 2126+19	586A  FD36FF58		ld	(iy-1),high(key_up_upper)
 289:				
 290: 2145+17	586E  CDAF58  		call note_on_upper
 291:				
 292: 2162+8	5871  FDE9    		jp	(iy)		; return to main key scan loop
 293:				
 294:     -	5873          	key_up_upper:
 295: 2170+14	5873  FDE1    		pop	iy		; same idea, but swap call nz <-> call z
 296: 2184+19	5875  FD36FDC4		ld	(iy-3),call_nz
 297: 2203+19	5879  FD36FE60		ld	(iy-2),low(key_down_upper)
 298: 2222+19	587D  FD36FF58		ld	(iy-1),high(key_down_upper)
 299:				
 300: 2241+17	5881  CD0159  		call note_off_upper
 301:				
 302: 2258+8	5884  FDE9    		jp	(iy)		
 303:				
 304:     -	5886          	note_on_lower: 
 305:				
 306: 2266+13	5886  3A0156  	  ld a,(chan1)
 307: 2279+7	5889  0E90    	  ld c,$90
 308: 2286+4	588B  81      	  add a, c
 309: 2290+11	588C  D308    	  out (8),a
 310:				  
 311: 2301+17	588E  CDE15B  	  call short_delay
 312:				
 313: 2318+13	5891  3A0356  	  ld a,(oct1)	
 314: 2331+4	5894  80      	  add a, b
 315: 2335+11	5895  D308    	  out (8),a
 316:				  
 317: 2346+17	5897  CDE15B  	  call short_delay
 318:				
 319: 2363+13	589A  3A0156  	  ld a,(chan1)
 320: 2376+4	589D  4F      	  ld c,a
 321: 2380+7	589E  0600    	  ld b,0
 322: 2387+14	58A0  DD212556	  ld ix,vol1
 323: 2401+15	58A4  DD09    	  add ix,bc
 324:				
 325: 2416+19	58A6  DD7E00  	  ld a,(ix)
 326: 2435+11	58A9  D308    	  out (8),a
 327:				  
 328: 2446+17	58AB  CDE15B  	  call short_delay  
 329:				
 330: 2463+10	58AE  C9      	  ret
 331:				
 332:     -	58AF          	note_on_upper:
 333:				
 334: 2473+13	58AF  3A0256  	  ld a,(chan2)
 335: 2486+7	58B2  0E90    	  ld c,$90
 336: 2493+4	58B4  81      	  add a, c
 337: 2497+11	58B5  D308    	  out (8),a
 338:				  
 339: 2508+17	58B7  CDE15B  	  call short_delay
 340:				
 341: 2525+13	58BA  3A0456  	  ld a,(oct2)	
 342: 2538+4	58BD  80      	  add a, b	
 343: 2542+11	58BE  D308    	  out (8),a
 344:				  
 345: 2553+17	58C0  CDE15B  	  call short_delay  
 346:				  
 347: 2570+13	58C3  3A0256  	  ld a,(chan2)
 348: 2583+4	58C6  4F      	  ld c,a
 349: 2587+7	58C7  0600    	  ld b,0
 350: 2594+14	58C9  DD213556	  ld ix,vol2
 351: 2608+15	58CD  DD09    	  add ix,bc
 352:				
 353: 2623+19	58CF  DD7E00  	  ld a,(ix)
 354: 2642+11	58D2  D308    	  out (8),a
 355:				  
 356: 2653+17	58D4  CDE15B  	  call short_delay  
 357:				
 358: 2670+10	58D7  C9      	  ret
 359:				
 360:     -	58D8          	note_off_lower: 
 361:				
 362: 2680+13	58D8  3A0156  	  ld a,(chan1)
 363: 2693+7	58DB  0E80    	  ld c,$80
 364: 2700+4	58DD  81      	  add a, c
 365: 2704+11	58DE  D308    	  out (8),a
 366:				  
 367: 2715+17	58E0  CDE15B  	  call short_delay
 368:				
 369: 2732+13	58E3  3A0356  	  ld a,(oct1)	
 370: 2745+4	58E6  80      	  add a, b
 371: 2749+11	58E7  D308    	  out (8),a
 372:				  
 373: 2760+17	58E9  CDE15B  	  call short_delay  
 374:				
 375: 2777+13	58EC  3A0156  	  ld a,(chan1)
 376: 2790+4	58EF  4F      	  ld c,a
 377: 2794+7	58F0  0600    	  ld b,0
 378: 2801+14	58F2  DD212556	  ld ix,vol1
 379: 2815+15	58F6  DD09    	  add ix,bc
 380:				
 381: 2830+19	58F8  DD7E00  	  ld a,(ix)
 382: 2849+11	58FB  D308    	  out (8),a  
 383:				  
 384: 2860+17	58FD  CDE15B  	  call short_delay  
 385:				
 386: 2877+10	5900  C9      	  ret  
 387:				
 388:				
 389:     -	5901          	note_off_upper: 
 390:				
 391: 2887+13	5901  3A0256  	  ld a,(chan2)
 392: 2900+7	5904  0E80    	  ld c,$80
 393: 2907+4	5906  81      	  add a, c
 394: 2911+11	5907  D308    	  out (8),a
 395:				  
 396: 2922+17	5909  CDE15B  	  call short_delay
 397:				  
 398: 2939+13	590C  3A0456  	  ld a,(oct2)	
 399: 2952+4	590F  80      	  add a, b
 400: 2956+11	5910  D308    	  out (8),a
 401:				  
 402: 2967+17	5912  CDE15B  	  call short_delay  
 403:				
 404: 2984+13	5915  3A0256  	  ld a,(chan2)
 405: 2997+4	5918  4F      	  ld c,a
 406: 3001+7	5919  0600    	  ld b,0
 407: 3008+14	591B  DD213556	  ld ix,vol2
 408: 3022+15	591F  DD09    	  add ix,bc
 409:				
 410: 3037+19	5921  DD7E00  	  ld a,(ix)
 411: 3056+11	5924  D308    	  out (8),a  
 412:				  
 413: 3067+17	5926  CDE15B  	  call short_delay  
 414:				
 415: 3084+10	5929  C9      	  ret  
 416:				
 417:     -	592A          	exit:
 418: 3094+14	592A  FDE1    		pop	iy
 419: 3108+17	592C  CD2D40  		call @EXIT	
 420:				
 421:     -	592F          	oct1_up_down:
 422:				
 423: 3125+14	592F  FDE1    		pop	iy
 424:				
 425: 3139+19	5931  FD36FDCC		ld	(iy-3),call_z
 426: 3158+19	5935  FD36FE52		ld	(iy-2),low(oct1_up_up)
 427: 3177+19	5939  FD36FF59		ld	(iy-1),high(oct1_up_up)
 428:				
 429: 3196+13	593D  3A0356  		ld a,(oct1)
 430: 3209+7	5940  FE60    		cp 96
 431: 3216+10	5942  D25059  		jp nc,oct1_up_exit
 432:					
 433: 3226+7	5945  060C    		ld b,12
 434: 3233+4	5947  80      		add a,b
 435: 3237+7	5948  E67F    		and $7f
 436: 3244+13	594A  320356  		ld (oct1),a
 437:				
 438: 3257+17	594D  CD0B5C  		call screenupdate
 439:					
 440:     -	5950          	oct1_up_exit:	
 441: 3274+8	5950  FDE9    		jp	(iy)
 442:				
 443:     -	5952          	oct1_up_up:
 444:				
 445: 3282+14	5952  FDE1    		pop	iy
 446:				
 447: 3296+19	5954  FD36FDC4		ld	(iy-3),call_nz	
 448: 3315+19	5958  FD36FE2F		ld	(iy-2),low(oct1_up_down)
 449: 3334+19	595C  FD36FF59		ld	(iy-1),high(oct1_up_down)
 450:				
 451: 3353+8	5960  FDE9    		jp	(iy)
 452:				
 453:     -	5962          	oct2_up_down:
 454:					
 455: 3361+14	5962  FDE1    		pop	iy
 456:				
 457: 3375+19	5964  FD36FDCC		ld	(iy-3),call_z
 458: 3394+19	5968  FD36FE85		ld	(iy-2),low(oct2_up_up)
 459: 3413+19	596C  FD36FF59		ld	(iy-1),high(oct2_up_up)
 460:				
 461: 3432+13	5970  3A0456  		ld a,(oct2)
 462: 3445+7	5973  FE60    		cp 96
 463: 3452+10	5975  D28359  		jp nc,oct2_up_exit
 464:				
 465: 3462+7	5978  060C    		ld b,12
 466: 3469+4	597A  80      		add a,b
 467: 3473+7	597B  E67F    		and $7f
 468: 3480+13	597D  320456  		ld (oct2),a
 469:				
 470: 3493+17	5980  CD0B5C  		call screenupdate	
 471:				
 472:     -	5983          	oct2_up_exit:	
 473: 3510+8	5983  FDE9    		jp	(iy)	
 474:				
 475:     -	5985          	oct2_up_up:
 476:				
 477: 3518+14	5985  FDE1    		pop	iy
 478:				
 479: 3532+19	5987  FD36FDC4		ld	(iy-3),call_nz	
 480: 3551+19	598B  FD36FE62		ld	(iy-2),low(oct2_up_down)
 481: 3570+19	598F  FD36FF59		ld	(iy-1),high(oct2_up_down)
 482:				
 483: 3589+8	5993  FDE9    		jp	(iy)
 484:				
 485:     -	5995          	oct1_down_down:
 486:					
 487: 3597+14	5995  FDE1    		pop	iy
 488:					
 489: 3611+19	5997  FD36FDCC		ld	(iy-3),call_z
 490: 3630+19	599B  FD36FEB8		ld	(iy-2),low(oct1_down_up)
 491: 3649+19	599F  FD36FF59		ld	(iy-1),high(oct1_down_up)
 492:					
 493: 3668+13	59A3  3A0356  		ld a,(oct1)
 494: 3681+7	59A6  FE19    		cp 25
 495: 3688+10	59A8  DAB659  		jp c,oct1_down_exit
 496:				
 497: 3698+7	59AB  060C    		ld b,12
 498: 3705+4	59AD  90      		sub a,b
 499: 3709+7	59AE  E67F    		and $7f
 500: 3716+13	59B0  320356  		ld (oct1),a
 501:				
 502: 3729+17	59B3  CD0B5C  		call screenupdate	
 503:				
 504:     -	59B6          	oct1_down_exit:	
 505: 3746+8	59B6  FDE9    		jp	(iy)
 506:				
 507:				
 508:     -	59B8          	oct1_down_up:
 509:				
 510: 3754+14	59B8  FDE1    		pop	iy
 511:				
 512: 3768+19	59BA  FD36FDC4		ld	(iy-3),call_nz	
 513: 3787+19	59BE  FD36FE95		ld	(iy-2),low(oct1_down_down)
 514: 3806+19	59C2  FD36FF59		ld	(iy-1),high(oct1_down_down)
 515:				
 516: 3825+8	59C6  FDE9    		jp	(iy)
 517:					
 518:     -	59C8          	oct2_down_down:
 519:					
 520: 3833+14	59C8  FDE1    		pop	iy
 521:				
 522: 3847+19	59CA  FD36FDCC		ld	(iy-3),call_z
 523: 3866+19	59CE  FD36FEEB		ld	(iy-2),low(oct2_down_up)
 524: 3885+19	59D2  FD36FF59		ld	(iy-1),high(oct2_down_up)	
 525:					
 526: 3904+13	59D6  3A0456  		ld a,(oct2)
 527: 3917+7	59D9  FE19    		cp 25
 528: 3924+10	59DB  DAE959  		jp c,oct2_down_exit
 529:				
 530: 3934+7	59DE  060C    		ld b,12
 531: 3941+4	59E0  90      		sub a,b
 532: 3945+7	59E1  E67F    		and $7f
 533: 3952+13	59E3  320456  		ld (oct2),a
 534:				
 535: 3965+17	59E6  CD0B5C  		call screenupdate	
 536:				
 537:     -	59E9          	oct2_down_exit:	
 538: 3982+8	59E9  FDE9    		jp	(iy)	
 539:				
 540:     -	59EB          	oct2_down_up:
 541:				
 542: 3990+14	59EB  FDE1    		pop	iy
 543:				
 544: 4004+19	59ED  FD36FDC4		ld	(iy-3),call_nz	
 545: 4023+19	59F1  FD36FEC8		ld	(iy-2),low(oct2_down_down)
 546: 4042+19	59F5  FD36FF59		ld	(iy-1),high(oct2_down_down)
 547:				
 548: 4061+8	59F9  FDE9    		jp	(iy)
 549:				
 550:					
 551:     -	59FB          	swap_channel_down:
 552:						
 553: 4069+14	59FB  FDE1    		pop	iy
 554:				
 555: 4083+19	59FD  FD36FDCC		ld	(iy-3),call_z
 556: 4102+19	5A01  FD36FE17		ld	(iy-2),low(swap_channel_up)
 557: 4121+19	5A05  FD36FF5A		ld	(iy-1),high(swap_channel_up)	
 558:					
 559: 4140+13	5A09  3A0056  		ld a,(current)
 560: 4153+4	5A0C  3C      		inc a
 561: 4157+7	5A0D  E601    		and $01
 562: 4164+13	5A0F  320056  		ld (current),a
 563:				
 564: 4177+17	5A12  CD0B5C  		call screenupdate	
 565:					
 566: 4194+8	5A15  FDE9    		jp	(iy)
 567:				
 568:     -	5A17          	swap_channel_up:
 569:						
 570: 4202+14	5A17  FDE1    		pop	iy
 571:				
 572: 4216+19	5A19  FD36FDC4		ld	(iy-3),call_nz	
 573: 4235+19	5A1D  FD36FEFB		ld	(iy-2),low(swap_channel_down)
 574: 4254+19	5A21  FD36FF59		ld	(iy-1),high(swap_channel_down)
 575:				
 576: 4273+8	5A25  FDE9    		jp	(iy)
 577:				
 578:     -	5A27          	incr_channel_down:
 579:						
 580: 4281+14	5A27  FDE1    		pop	iy
 581:					
 582: 4295+19	5A29  FD36FDCC		ld	(iy-3),call_z
 583: 4314+19	5A2D  FD36FE5A		ld	(iy-2),low(incr_channel_up)
 584: 4333+19	5A31  FD36FF5A		ld	(iy-1),high(incr_channel_up)
 585:					
 586: 4352+13	5A35  3A0056  		ld a,(current)
 587: 4365+4	5A38  B7      		or a
 588: 4369+7+5	5A39  280B    		jr z, incr_channel1
 589:				
 590:					; channel 2 
 591:				
 592: 4376+13	5A3B  3A0256  		ld a, (chan2) 
 593: 4389+4	5A3E  3C      		inc a
 594: 4393+7	5A3F  E60F    		and $0f
 595: 4400+13	5A41  320256  		ld (chan2), a
 596:				
 597: 4413+12	5A44  1809    		jr incr_channel_return
 598:				
 599:     -	5A46          	incr_channel1:
 600: 4425+13	5A46  3A0156  		ld a, (chan1) 
 601: 4438+4	5A49  3C      		inc a
 602: 4442+7	5A4A  E60F    		and $0f
 603: 4449+13	5A4C  320156  		ld (chan1), a
 604:						
 605:     -	5A4F          	incr_channel_return: 
 606: 4462+17	5A4F  CD0B5C  		call screenupdate
 607: 4479+17	5A52  CD9A5C  		call setinstrument_lower
 608: 4496+17	5A55  CDBA5C  		call setinstrument_upper
 609:					
 610: 4513+8	5A58  FDE9    		jp	(iy)
 611:				
 612:					
 613:     -	5A5A          	incr_channel_up:
 614:						
 615: 4521+14	5A5A  FDE1    		pop	iy
 616:					
 617: 4535+19	5A5C  FD36FDC4		ld	(iy-3),call_nz	
 618: 4554+19	5A60  FD36FE27		ld	(iy-2),low(incr_channel_down)
 619: 4573+19	5A64  FD36FF5A		ld	(iy-1),high(incr_channel_down)
 620:					
 621: 4592+8	5A68  FDE9    		jp	(iy)
 622:				
 623:     -	5A6A          	decr_channel_down:
 624:					
 625: 4600+14	5A6A  FDE1    		pop	iy
 626:					
 627: 4614+19	5A6C  FD36FDCC		ld	(iy-3),call_z
 628: 4633+19	5A70  FD36FE9D		ld	(iy-2),low(decr_channel_up)
 629: 4652+19	5A74  FD36FF5A		ld	(iy-1),high(decr_channel_up)
 630:					
 631: 4671+13	5A78  3A0056  		ld a,(current)
 632: 4684+4	5A7B  B7      		or a
 633: 4688+7+5	5A7C  280B    		jr z, decr_channel1
 634:				
 635:					; channel 2 
 636:				
 637: 4695+13	5A7E  3A0256  		ld a, (chan2) 
 638: 4708+4	5A81  3D      		dec a
 639: 4712+7	5A82  E60F    		and $0f
 640: 4719+13	5A84  320256  		ld (chan2), a
 641:				
 642: 4732+12	5A87  1809    		jr decr_channel_return
 643:				
 644:     -	5A89          	decr_channel1:
 645: 4744+13	5A89  3A0156  		ld a, (chan1) 
 646: 4757+4	5A8C  3D      		dec a
 647: 4761+7	5A8D  E60F    		and $0f
 648: 4768+13	5A8F  320156  		ld (chan1), a
 649:						
 650:     -	5A92          	decr_channel_return: 
 651: 4781+17	5A92  CD0B5C  		call screenupdate
 652: 4798+17	5A95  CD9A5C  		call setinstrument_lower
 653: 4815+17	5A98  CDBA5C  		call setinstrument_upper
 654:				
 655: 4832+8	5A9B  FDE9    		jp	(iy)
 656:					
 657:     -	5A9D          	decr_channel_up:
 658:					
 659: 4840+14	5A9D  FDE1    		pop	iy
 660:					
 661: 4854+19	5A9F  FD36FDC4		ld	(iy-3),call_nz	
 662: 4873+19	5AA3  FD36FE6A		ld	(iy-2),low(decr_channel_down)
 663: 4892+19	5AA7  FD36FF5A		ld	(iy-1),high(decr_channel_down)
 664:					
 665: 4911+8	5AAB  FDE9    		jp	(iy)
 666:				
 667:     -	5AAD          	incr_instr_down:
 668:					
 669: 4919+14	5AAD  FDE1    		pop	iy
 670:					
 671: 4933+19	5AAF  FD36FDCC		ld	(iy-3),call_z
 672: 4952+19	5AB3  FD36FEED		ld	(iy-2),low(incr_instr_up)
 673: 4971+19	5AB7  FD36FF5A		ld	(iy-1),high(incr_instr_up)
 674:				
 675: 4990+13	5ABB  3A0056  		ld a,(current)
 676: 5003+4	5ABE  B7      		or a
 677: 5007+7+5	5ABF  280C    		jr z, incr_instr1
 678:				
 679:					; channel 2 
 680:				
 681: 5014+13	5AC1  3A0256  		ld a, (chan2)	
 682: 5027+4	5AC4  4F      		ld c, a
 683: 5031+7	5AC5  0600    		ld b, 0
 684: 5038+14	5AC7  DD211556		ld ix, instr2
 685: 5052+12	5ACB  180A    		jr incr_instr_return
 686:				
 687:     -	5ACD          	incr_instr1:
 688:				
 689: 5064+13	5ACD  3A0156  		ld a, (chan1)	
 690: 5077+4	5AD0  4F      		ld c, a
 691: 5081+7	5AD1  0600    		ld b, 0
 692: 5088+14	5AD3  DD210556		ld ix, instr1
 693:						
 694:     -	5AD7          	incr_instr_return:
 695:				
 696: 5102+15	5AD7  DD09    		add ix, bc
 697:				
 698: 5117+19	5AD9  DD7E00  		ld a, (ix) 
 699: 5136+4	5ADC  3C      		inc a
 700: 5140+7	5ADD  E67F    		and $7f
 701: 5147+19	5ADF  DD7700  		ld (ix), a
 702:					
 703: 5166+17	5AE2  CD0B5C  		call screenupdate
 704: 5183+17	5AE5  CD9A5C  		call setinstrument_lower
 705: 5200+17	5AE8  CDBA5C  		call setinstrument_upper
 706:				
 707: 5217+8	5AEB  FDE9    		jp	(iy)
 708:				
 709:     -	5AED          	incr_instr_up:
 710:					
 711: 5225+14	5AED  FDE1    		pop	iy
 712:					
 713: 5239+19	5AEF  FD36FDC4		ld	(iy-3),call_nz
 714: 5258+19	5AF3  FD36FEAD		ld	(iy-2),low(incr_instr_down)
 715: 5277+19	5AF7  FD36FF5A		ld	(iy-1),high(incr_instr_down)
 716:				
 717: 5296+8	5AFB  FDE9    		jp	(iy)
 718:				
 719:     -	5AFD          	decr_instr_down:
 720:					
 721: 5304+14	5AFD  FDE1    		pop	iy
 722:				
 723: 5318+19	5AFF  FD36FDCC		ld	(iy-3),call_z
 724: 5337+19	5B03  FD36FE3D		ld	(iy-2),low(decr_instr_up)
 725: 5356+19	5B07  FD36FF5B		ld	(iy-1),high(decr_instr_up)
 726:					
 727: 5375+13	5B0B  3A0056  		ld a,(current)
 728: 5388+4	5B0E  B7      		or a
 729: 5392+7+5	5B0F  280C    		jr z, decr_instr1
 730:				
 731:					; channel 2 
 732:				
 733: 5399+13	5B11  3A0256  		ld a, (chan2)	
 734: 5412+4	5B14  4F      		ld c, a
 735: 5416+7	5B15  0600    		ld b, 0
 736: 5423+14	5B17  DD211556		ld ix, instr2
 737: 5437+12	5B1B  180A    		jr decr_instr_return
 738:				
 739:     -	5B1D          	decr_instr1:
 740:				
 741: 5449+13	5B1D  3A0156  		ld a, (chan1)	
 742: 5462+4	5B20  4F      		ld c, a
 743: 5466+7	5B21  0600    		ld b, 0
 744: 5473+14	5B23  DD210556		ld ix, instr1
 745:						
 746:     -	5B27          	decr_instr_return:
 747:				
 748: 5487+15	5B27  DD09    		add ix, bc
 749:				
 750: 5502+19	5B29  DD7E00  		ld a, (ix) 
 751: 5521+4	5B2C  3D      		dec a
 752: 5525+7	5B2D  E67F    		and $7f
 753: 5532+19	5B2F  DD7700  		ld (ix), a
 754:					
 755: 5551+17	5B32  CD0B5C  		call screenupdate
 756: 5568+17	5B35  CD9A5C  		call setinstrument_lower
 757: 5585+17	5B38  CDBA5C  		call setinstrument_upper
 758:				
 759: 5602+8	5B3B  FDE9    		jp	(iy)
 760:				
 761:				
 762:     -	5B3D          	decr_instr_up:
 763:					
 764: 5610+14	5B3D  FDE1    		pop	iy
 765:				
 766: 5624+19	5B3F  FD36FDC4		ld	(iy-3),call_nz
 767: 5643+19	5B43  FD36FEFD		ld	(iy-2),low(decr_instr_down)
 768: 5662+19	5B47  FD36FF5A		ld	(iy-1),high(decr_instr_down)
 769:				
 770: 5681+8	5B4B  FDE9    		jp	(iy)
 771:					
 772:     -	5B4D          	incr_vol_down:
 773:				
 774: 5689+14	5B4D  FDE1    		pop	iy
 775:				
 776: 5703+19	5B4F  FD36FDCC		ld	(iy-3),call_z
 777: 5722+19	5B53  FD36FE87		ld	(iy-2),low(incr_vol_up)
 778: 5741+19	5B57  FD36FF5B		ld	(iy-1),high(incr_vol_up)
 779:				
 780: 5760+13	5B5B  3A0056  		ld a,(current)
 781: 5773+4	5B5E  B7      		or a
 782: 5777+7+5	5B5F  280C    		jr z, incr_vol1
 783:				
 784:					; channel 2 
 785:				
 786: 5784+13	5B61  3A0256  		ld a, (chan2)	
 787: 5797+4	5B64  4F      		ld c, a
 788: 5801+7	5B65  0600    		ld b, 0
 789: 5808+14	5B67  DD213556		ld ix, vol2
 790: 5822+12	5B6B  180A    		jr incr_vol_return
 791:				
 792:     -	5B6D          	incr_vol1:
 793:				
 794: 5834+13	5B6D  3A0156  		ld a, (chan1)	
 795: 5847+4	5B70  4F      		ld c, a
 796: 5851+7	5B71  0600    		ld b, 0
 797: 5858+14	5B73  DD212556		ld ix, vol1
 798:						
 799:     -	5B77          	incr_vol_return:
 800:				
 801: 5872+15	5B77  DD09    		add ix, bc
 802:				
 803: 5887+19	5B79  DD7E00  		ld a, (ix) 
 804: 5906+4	5B7C  3C      		inc a
 805: 5910+7	5B7D  E67F    		and $7f
 806: 5917+19	5B7F  DD7700  		ld (ix), a
 807:					
 808: 5936+17	5B82  CD0B5C  		call screenupdate
 809:				
 810: 5953+8	5B85  FDE9    		jp	(iy)
 811:				
 812:     -	5B87          	incr_vol_up:
 813:				
 814: 5961+14	5B87  FDE1    		pop	iy
 815:				
 816: 5975+19	5B89  FD36FDC4		ld	(iy-3),call_nz
 817: 5994+19	5B8D  FD36FE4D		ld	(iy-2),low(incr_vol_down)
 818: 6013+19	5B91  FD36FF5B		ld	(iy-1),high(incr_vol_down)
 819:				
 820: 6032+8	5B95  FDE9    		jp	(iy)
 821:				
 822:     -	5B97          	decr_vol_down:
 823:					
 824: 6040+14	5B97  FDE1    		pop	iy
 825:					
 826: 6054+19	5B99  FD36FDCC		ld	(iy-3),call_z
 827: 6073+19	5B9D  FD36FED1		ld	(iy-2),low(decr_vol_up)
 828: 6092+19	5BA1  FD36FF5B		ld	(iy-1),high(decr_vol_up)
 829:				
 830: 6111+13	5BA5  3A0056  		ld a,(current)
 831: 6124+4	5BA8  B7      		or a
 832: 6128+7+5	5BA9  280C    		jr z, decr_vol1
 833:				
 834:					; channel 2 
 835:				
 836: 6135+13	5BAB  3A0256  		ld a, (chan2)	
 837: 6148+4	5BAE  4F      		ld c, a
 838: 6152+7	5BAF  0600    		ld b, 0
 839: 6159+14	5BB1  DD213556		ld ix, vol2
 840: 6173+12	5BB5  180A    		jr decr_vol_return
 841:				
 842:     -	5BB7          	decr_vol1:
 843:				
 844: 6185+13	5BB7  3A0156  		ld a, (chan1)	
 845: 6198+4	5BBA  4F      		ld c, a
 846: 6202+7	5BBB  0600    		ld b, 0
 847: 6209+14	5BBD  DD212556		ld ix, vol1
 848:						
 849:     -	5BC1          	decr_vol_return:
 850:				
 851: 6223+15	5BC1  DD09    		add ix, bc
 852:				
 853: 6238+19	5BC3  DD7E00  		ld a, (ix) 
 854: 6257+4	5BC6  3D      		dec a
 855: 6261+7	5BC7  E67F    		and $7f
 856: 6268+19	5BC9  DD7700  		ld (ix), a
 857:					
 858: 6287+17	5BCC  CD0B5C  		call screenupdate	
 859:					
 860: 6304+8	5BCF  FDE9    		jp	(iy)
 861:				
 862:     -	5BD1          	decr_vol_up:
 863:				
 864: 6312+14	5BD1  FDE1    		pop	iy
 865:				
 866: 6326+19	5BD3  FD36FDC4		ld	(iy-3),call_nz	
 867: 6345+19	5BD7  FD36FE97		ld	(iy-2),low(decr_vol_down)
 868: 6364+19	5BDB  FD36FF5B		ld	(iy-1),high(decr_vol_down)
 869:				
 870: 6383+8	5BDF  FDE9    		jp	(iy)
 871:				
 872:					
 873:     -	5BE1          	short_delay:
 874: 6391+10	5BE1  111000  	    ld de,$0010
 875:     -	5BE4          	loop: 
 876: 6401+6	5BE4  1B      	    dec de
 877: 6407+4	5BE5  7A      	    ld a,d
 878: 6411+4	5BE6  B3      	    or e
 879: 6415+10	5BE7  C2E45B  	    jp nz,loop
 880: 6425+10	5BEA  C9      	    ret 
 881:				
 882:     -	5BEB          	byte2ascii: 			; input c, output de ASCII 
 883: 6435+4	5BEB  79      	   ld a, c
 884: 6439+4	5BEC  1F      	   rra
 885: 6443+4	5BED  1F      	   rra
 886: 6447+4	5BEE  1F      	   rra
 887: 6451+4	5BEF  1F      	   rra
 888: 6455+17	5BF0  CDF55B  	   call convnibble 
 889: 6472+4	5BF3  57      	   ld d, a	
 890: 6476+4	5BF4  79      	   ld  a,c
 891:     -	5BF5          	convnibble:
 892: 6480+7	5BF5  E60F    	   and  $0F
 893: 6487+7	5BF7  C690    	   add  a,$90
 894: 6494+4	5BF9  27      	   daa
 895: 6498+7	5BFA  CE40    	   adc  a,$40
 896: 6505+4	5BFC  27      	   daa
 897: 6509+4	5BFD  5F      	   ld e, a	
 898: 6513+10	5BFE  C9      	   ret
 899:				
 900:     -	5BFF          	showvalue:  ; input ix mem cell, hl screen location 
 901: 6523+19	5BFF  DD4E00  		ld c,(ix)
 902: 6542+17	5C02  CDEB5B  		call byte2ascii
 903: 6559+7	5C05  72      		ld (hl),d
 904: 6566+6	5C06  23      		inc hl
 905: 6572+7	5C07  73      		ld (hl),e
 906: 6579+6	5C08  23      		inc hl
 907: 6585+6	5C09  23      		inc hl
 908:				
 909: 6591+10	5C0A  C9      	ret
 910:				
 911:				
 912:     -	5C0B          	screenupdate:
 913: 6601+10	5C0B  21A33F  		ld hl,$3c00+14*64+35
 914:				
 915: 6611+14	5C0E  DD210356		ld ix,oct1
 916: 6625+17	5C12  CDFF5B  		call showvalue
 917:				
 918: 6642+14	5C15  DD210156		ld ix,chan1
 919: 6656+17	5C19  CDFF5B  		call showvalue
 920:				
 921: 6673+14	5C1C  DD210556		ld ix,instr1
 922: 6687+13	5C20  3A0156  		ld a,(chan1)
 923: 6700+4	5C23  4F      		ld c,a
 924: 6704+7	5C24  0600    		ld b,0
 925: 6711+15	5C26  DD09    		add ix,bc
 926: 6726+17	5C28  CDFF5B  		call showvalue
 927:					
 928:				
 929: 6743+14	5C2B  DD212556		ld ix,vol1
 930: 6757+13	5C2F  3A0156  		ld a,(chan1)
 931: 6770+4	5C32  4F      		ld c,a
 932: 6774+7	5C33  0600    		ld b,0
 933: 6781+15	5C35  DD09    		add ix,bc
 934: 6796+17	5C37  CDFF5B  		call showvalue	
 935:				
 936: 6813+6	5C3A  23      		inc hl
 937: 6819+6	5C3B  23      		inc hl
 938: 6825+6	5C3C  23      		inc hl
 939: 6831+6	5C3D  23      		inc hl
 940:				
 941: 6837+14	5C3E  DD210456		ld ix,oct2
 942: 6851+17	5C42  CDFF5B  		call showvalue
 943:				
 944: 6868+14	5C45  DD210256		ld ix,chan2
 945: 6882+17	5C49  CDFF5B  		call showvalue
 946:					
 947: 6899+14	5C4C  DD211556		ld ix,instr2
 948: 6913+13	5C50  3A0256  		ld a,(chan2)
 949: 6926+4	5C53  4F      		ld c,a
 950: 6930+7	5C54  0600    		ld b,0
 951: 6937+15	5C56  DD09    		add ix,bc
 952: 6952+17	5C58  CDFF5B  		call showvalue	
 953:				
 954: 6969+14	5C5B  DD213556		ld ix,vol2
 955: 6983+13	5C5F  3A0256  		ld a,(chan2)
 956: 6996+4	5C62  4F      		ld c,a
 957: 7000+7	5C63  0600    		ld b,0
 958: 7007+15	5C65  DD09    		add ix,bc
 959: 7022+17	5C67  CDFF5B  		call showvalue	
 960:				
 961:					;;
 962:					;;
 963:					;;
 964:					
 965: 7039+13	5C6A  3A0056  		ld a,(current)
 966: 7052+4	5C6D  B7      		or a
 967: 7056+7+5	5C6E  2015    		jr nz, showcur2
 968:				
 969: 7063+10	5C70  21A23F  		ld hl,$3c00+14*64+34
 970: 7073+10	5C73  363C    		ld (hl),'<'
 971: 7083+10	5C75  21AE3F  		ld hl,$3c00+14*64+46
 972: 7093+10	5C78  363E    		ld (hl),'>'
 973:				
 974: 7103+10	5C7A  21B23F  		ld hl,$3c00+14*64+50
 975: 7113+10	5C7D  3620    		ld (hl),' '
 976: 7123+10	5C7F  21BE3F  		ld hl,$3c00+14*64+62
 977: 7133+10	5C82  3620    		ld (hl),' '
 978:				
 979: 7143+10	5C84  C9      		ret
 980:				
 981:     -	5C85          	showcur2:
 982:				
 983: 7153+10	5C85  21A23F  		ld hl,$3c00+14*64+34
 984: 7163+10	5C88  3620    		ld (hl),' '
 985: 7173+10	5C8A  21AE3F  		ld hl,$3c00+14*64+46
 986: 7183+10	5C8D  3620    		ld (hl),' '
 987:				
 988:				
 989: 7193+10	5C8F  21B23F  		ld hl,$3c00+14*64+50
 990: 7203+10	5C92  363C    		ld (hl),'<'
 991: 7213+10	5C94  21BE3F  		ld hl,$3c00+14*64+62
 992: 7223+10	5C97  363E    		ld (hl),'>'
 993:					
 994: 7233+10	5C99  C9      		ret
 995:				
 996:				
 997:     -	5C9A          	setinstrument_lower:
 998:				
 999: 7243+7	5C9A  06C0    		ld b,$c0
1000: 7250+13	5C9C  3A0156  		ld a,(chan1)
1001: 7263+4	5C9F  80      		add a,b
1002: 7267+11	5CA0  D308    		out (8),a  ; change instrument for channel
1003: 7278+17	5CA2  CDE15B  		call short_delay
1004:				
1005: 7295+14	5CA5  DD210556		ld ix,instr1
1006: 7309+13	5CA9  3A0156  		ld a,(chan1)
1007: 7322+4	5CAC  4F      		ld c,a
1008: 7326+7	5CAD  0600    		ld b,0
1009: 7333+15	5CAF  DD09    		add ix,bc
1010:				
1011: 7348+19	5CB1  DD7E00  		ld a,(ix) ; instrument for selected channel
1012: 7367+11	5CB4  D308    		out (8),a  ; change instrument 
1013: 7378+17	5CB6  CDE15B  		call short_delay
1014:				 
1015: 7395+10	5CB9  C9      		ret
1016:				
1017:     -	5CBA          	setinstrument_upper:
1018:				
1019: 7405+7	5CBA  06C0    		ld b,$c0
1020: 7412+13	5CBC  3A0256  		ld a,(chan2)
1021: 7425+4	5CBF  80      		add a,b
1022: 7429+11	5CC0  D308    		out (8),a  ; change instrument for channel
1023: 7440+17	5CC2  CDE15B  		call short_delay
1024:				
1025: 7457+14	5CC5  DD211556		ld ix,instr2
1026: 7471+13	5CC9  3A0256  		ld a,(chan2)
1027: 7484+4	5CCC  4F      		ld c,a
1028: 7488+7	5CCD  0600    		ld b,0
1029: 7495+15	5CCF  DD09    		add ix,bc
1030:				
1031: 7510+19	5CD1  DD7E00  		ld a,(ix) ; instrument for selected channel
1032: 7529+11	5CD4  D308    		out (8),a  ; change instrument 
1033: 7540+17	5CD6  CDE15B  		call short_delay
1034:				 
1035: 7557+10	5CD9  C9      		ret
1036:				
1037:     -	5645          	  end start



Statistics:

     4	passes
     0	jr promotions
   190	symbols
  2778	bytes

   146	macro calls
   213	macro bytes
     0	invented symbols



Symbol Table:

@EXIT          =402D      16429
@KEY           =49        73
byte2ascii      5BEB      23531
call_nz        =C4        196
call_z         =CC        204
chan1           5601      22017
chan2           5602      22018
convnibble      5BF5      23541
current         5600      22016
decr_channel1   5A89      23177
decr_channel_down 5A6A      23146
decr_channel_return 5A92      23186
decr_channel_up 5A9D      23197
decr_instr1     5B1D      23325
decr_instr_down 5AFD      23293
decr_instr_return 5B27      23335
decr_instr_up   5B3D      23357
decr_vol1       5BB7      23479
decr_vol_down   5B97      23447
decr_vol_return 5BC1      23489
decr_vol_up     5BD1      23505
exit            592A      22826
incr_channel1   5A46      23110
incr_channel_down 5A27      23079
incr_channel_return 5A4F      23119
incr_channel_up 5A5A      23130
incr_instr1     5ACD      23245
incr_instr_down 5AAD      23213
incr_instr_return 5AD7      23255
incr_instr_up   5AED      23277
incr_vol1       5B6D      23405
incr_vol_down   5B4D      23373
incr_vol_return 5B77      23415
incr_vol_up     5B87      23431
init            5658      22104
instr1          5605      22021
instr2          5615      22037
k_0            =00381001  3674113
k_1            =00381002  3674114
k_2            =00381004  3674116
k_3            =00381008  3674120
k_4            =00381010  3674128
k_5            =00381020  3674144
k_6            =00381040  3674176
k_7            =00381080  3674240
k_8            =00382001  3678209
k_9            =00382002  3678210
k_@            =00380101  3670273
k_A            =00380102  3670274
k_B            =00380104  3670276
k_C            =00380108  3670280
k_D            =00380110  3670288
k_E            =00380120  3670304
k_F            =00380140  3670336
k_G            =00380180  3670400
k_H            =00380201  3670529
k_I            =00380202  3670530
k_J            =00380204  3670532
k_K            =00380208  3670536
k_L            =00380210  3670544
k_M            =00380220  3670560
k_N            =00380240  3670592
k_O            =00380280  3670656
k_P            =00380401  3671041
k_Q            =00380402  3671042
k_R            =00380404  3671044
k_S            =00380408  3671048
k_T            =00380410  3671056
k_U            =00380420  3671072
k_V            =00380440  3671104
k_W            =00380480  3671168
k_X            =00380801  3672065
k_Y            =00380802  3672066
k_Z            =00380804  3672068
k_break        =00384004  3686404
k_clear        =00384002  3686402
k_colon        =00382004  3678212
k_comma        =00382010  3678224
k_dash         =00382020  3678240
k_dot          =00382040  3678272
k_down         =00384010  3686416
k_enter        =00384001  3686401
k_left         =00384020  3686432
k_right        =00384040  3686464
k_semi         =00382008  3678216
k_shift        =00388001  3702785
k_slash        =00382080  3678336
k_space        =00384080  3686528
k_up           =00384008  3686408
key_down_lower  583A      22586
key_down_upper  5860      22624
key_up_lower    584D      22605
key_up_upper    5873      22643
loop            5BE4      23524
main            5661      22113
note           =20        32
note_off_lower  58D8      22744
note_off_upper  5901      22785
note_on_lower   5886      22662
note_on_upper   58AF      22703
nt             =20        32
oct1            5603      22019
oct1_down_down  5995      22933
oct1_down_exit  59B6      22966
oct1_down_up    59B8      22968
oct1_up_down    592F      22831
oct1_up_exit    5950      22864
oct1_up_up      5952      22866
oct2            5604      22020
oct2_down_down  59C8      22984
oct2_down_exit  59E9      23017
oct2_down_up    59EB      23019
oct2_up_down    5962      22882
oct2_up_exit    5983      22915
oct2_up_up      5985      22917
screenupdate    5C0B      23563
setinstrument_lower 5C9A      23706
setinstrument_upper 5CBA      23738
short_delay     5BE1      23521
showcur2        5C85      23685
showvalue       5BFF      23551
st_a0          =09        9
st_a0@         =0A        10
st_a1          =15        21
st_a1@         =16        22
st_b0          =0B        11
st_b1          =17        23
st_c0          =00        0
st_c0@         =01        1
st_c1          =0C        12
st_c1@         =0D        13
st_c2          =18        24
st_c2@         =19        25
st_d0          =02        2
st_d0@         =03        3
st_d1          =0E        14
st_d1@         =0F        15
st_d2          =1A        26
st_d2@         =1B        27
st_e0          =04        4
st_e1          =10        16
st_e2          =1C        28
st_f0          =05        5
st_f0@         =06        6
st_f1          =11        17
st_f1@         =12        18
st_f2          =1D        29
st_g0          =07        7
st_g0@         =08        8
st_g1          =13        19
st_g1@         =14        20
start           5645      22085
step_0         =00        0
step_1         =01        1
step_10        =0A        10
step_11        =0B        11
step_12        =0C        12
step_13        =0D        13
step_14        =0E        14
step_15        =0F        15
step_16        =10        16
step_17        =11        17
step_18        =12        18
step_19        =13        19
step_2         =02        2
step_20        =14        20
step_21        =15        21
step_22        =16        22
step_23        =17        23
step_24        =18        24
step_25        =19        25
step_26        =1A        26
step_27        =1B        27
step_28        =1C        28
step_29        =1D        29
step_3         =03        3
step_30        =1E        30
step_31        =1F        31
step_4         =04        4
step_5         =05        5
step_6         =06        6
step_7         =07        7
step_8         =08        8
step_9         =09        9
swap_channel_down 59FB      23035
swap_channel_up 5A17      23063
title           5200      20992
title_len      = 400      1024
vol1            5625      22053
vol2            5635      22069
